/*****************************************************
$Header: deltat.c,v 1.10 93/01/27 14:37:06 alois Exp $
deltat.c
deltat(t): returns delta t (in julian days) from universal time t
is included by users
ET = UT +  deltat

  ---------------------------------------------------------------
  | Copyright Astrodienst Zurich AG and Alois Treindl, 1989.	|
  | The use of this source code is subject to regulations made	|
  | by Astrodienst Zurich. The code is NOT in the public domain.|
  |								|
  | This copyright notice must not be changed or removed	|
  | by any user of this program.				|
  ---------------------------------------------------------------

******************************************************/

double deltat (double jd_ad) /* Astrodienst relative julian date */
{ 
  double floor();
  static short int dt[] = {	/* in centiseconds */
	/* dt from 1637 to 2000, as tabulated in A.E. 
	the values 1620 - 1636 are not taken, as they fit
	badly the parabola 25.5 t*t for the next range. The
	best crossing point to switch to the parabola is
	1637, where we have fitted the value for continuity */
	6780,	6500,	6300,	
	6200,	6000,	5800,	5700,	5500,
	5400,	5300,	5100,	5000,	4900,
	4800,	4700,	4600,	4500,	4400,
	4300,	4200,	4100,	4000,	3800,	/* 1655 - 59 */
	3700,	3600,	3500,	3400,	3300,
	3200,	3100,	3000,	2800,	2700,
	2600,	2500,	2400,	2300,	2200,
	2100,	2000,	1900,	1800,	1700,
	1600,	1500,	1400,	1400,	1300,
	1200,	1200,	1100,	1100,	1000,
	1000,	1000,	900,	900,	900,
	900,	900,	900,	900,	900,
	900,	900,	900,	900,	900,	/* 1700 - 1704 */
	900,	900,	900,	1000,	1000,
	1000,	1000,	1000,	1000,	1000,
	1000,	1000,	1100,	1100,	1100,
	1100,	1100,	1100,	1100,	1100,
	1100,	1100,	1100,	1100,	1100,
	1100,	1100,	1100,	1100,	1200,	/* 1730	- 1734 */
	1200,	1200,	1200,	1200,	1200,
	1200,	1200,	1200,	1200,	1300,
	1300,	1300,	1300,	1300,	1300,
	1300,	1400,	1400,	1400,	1400,
	1400,	1400,	1400,	1500,	1500,
	1500,	1500,	1500,	1500,	1500,	/* 1760 - 1764 */
	1600,	1600,	1600,	1600,	1600,
	1600,	1600,	1600,	1600,	1600,
	1700,	1700,	1700,	1700,	1700,
	1700,	1700,	1700,	1700,	1700,
	1700,	1700,	1700,	1700,	1700,
	1700,	1700,	1600,	1600,	1600,	/* 1790 - 1794 */
	1600,	1500,	1500,	1400,	1400,
	1370,	1340,	1310,	1290,	1270,	/* 1800 - 1804 */
	1260,	1250,	1250,	1250,	1250,
	1250,	1250,	1250,	1250,	1250,
	1250,	1250,	1240,	1230,	1220,
	1200,	1170,	1140,	1110,	1060,
	1020,	960,	910,	860,	800,
	750,	700,	660,	630,	600,	/* 1830 - 1834 */
	580,	570,	560,	560,	560,
	570,	580,	590,	610,	620,
	630,	650,	660,	680,	690,
	710,	720,	730,	740,	750,
	760,	770,	770,	780,	780,
	788,	782,	754,	697,	640,	/* 1860 - 1864 */
	602,	541,	410,	292,	182,
	161,	10,	-102,	-128,	-269,
	-324,	-364,	-454,	-471,	-511,
	-540,	-542,	-520,	-546,	-546,
	-579,	-563,	-564,	-580,	-566,
	-587,	-601,	-619,	-664,	-644,	/* 1890 - 1894 */
	-647,	-609,	-576,	-466,	-374,
	-272,	-154,	-2,	124,	264,
	386,	537,	614,	775,	913,
	1046,	1153,	1336,	1465,	1601,
	1720,	1824,	1906,	2025,	2095,
	2116,	2225,	2241,	2303,	2349,	/* 1920 - 1924 */
	2362,	2386,	2449,	2434,	2408,
	2402,	2400,	2387,	2395,	2386,
	2393,	2373,	2392,	2396,	2402,
	2433,	2483,	2530,	2570,	2624,
	2677,	2728,	2778,	2825,	2871,
	2915,	2957,	2997,	3036,	3072,	/* 1950 - 1954 */
	3107,	3135,	3168,	3218,	3268,
	3315,	3359,	3400,	3447,	3503,
	3573,	3654,	3743,	3829,	3920,
	4018,	4117,	4223,	4337,	4449,
	4548,	4646,	4752,	4853,	4959,
	5054,	5138,	5217,	5296,	5379,	/* 1980 - 1984 */
	5434,	5487,	5532,	5582,	5630,	/* 1985 - 89 from AE 1991 */
	5686,	5757,	5900,	5900,	6000,	/* AE 1993 and extrapol */
	6050,	6100,	6150,	6200,	6250,	/* 1995 - 1999 */
	6300};					/* 2000 */
  double yr, cy, delta;
  long iyr, i;
  yr = (jd_ad + 18262) / 365.25 + 100.0;    /*  year  relative 1800 */
  cy = yr / 100;
  iyr =  (long) (floor (yr) + 1800);	 /* truncated to integer, rel 0 */
# if TIDAL_26			/* Stephenson formula only when 26" tidal
				   term in lunar motion */
  if ( iyr >= 1637  && iyr < 2000 ) {
    i = iyr - 1637;
    delta = dt[i] * 0.01 + (dt[i+1] - dt[i]) * (yr - floor (yr)) * 0.01;
  } else if (iyr >= 2000 ) {	/* parabola, fitted at value[2000] */
    delta = 25.5 * cy * cy  - 25.5 * 4 + 63.00;	
  } else if (iyr >= 948) {	/* from 948 - 1637 use parabola */
    delta = 25.5 * cy * cy;	
  } else {	/* before 984 use other parabola */	
    delta = 1361.7	+ 320 * cy + 44.3 * cy * cy;	/* fits at 948 */
  }
# else	/* use Clemence value + 5 sec before 1690, new dt afterwards */
  cy -= 1;	/* epoch 1900 */
  if ( iyr >= 1690  && iyr < 2000 ) {
    i = iyr - 1637;
    delta = dt[i] * 0.01 + (dt[i+1] - dt[i]) * (yr - floor (yr)) * 0.01;
  } else if (iyr >= 2000 ) {	/* parabola, fitted at value[2000] */
    delta = 29.949 * cy * cy  - 29.949 * 4 + 63.0;	
  } else {	
    delta = 5 + 24.349 + 72.3165 * cy + 29.949 * cy * cy; /* fits at 1690 */
  }
# endif
  return (delta / 86400.0);
}
